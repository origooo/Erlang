{
   "_id": "_design/update",
   "language": "javascript",
   "updates": {
       "Update": "function(doc, req) {\n\tvar jsn = JSON.parse(req.body);\n\tvar Status, Name, Symbol, LastPrice, Change, ChangePercent, High, Low, Open, LocalTimestamp, Close, Volume;\n\tvar now = new Date();\n\tLocalTimestamp = jsn.Data.Timestamp;\n\tName = jsn.Data.Name;\n\tSymbol = jsn.Data.Symbol;\n\tLastPrice = jsn.Data.LastPrice;\n\tChange = jsn.Data.Change;\n\tChangePercent = jsn.Data.ChangePercent;\n\tHigh = jsn.Data.High;\n\tLow = jsn.Data.Low;\n\tOpen = jsn.Data.Open;\n\tVolume = jsn.Data.Volume;\n\tif(jsn.Data.Close){\n\t\tClose=jsn.Data.Close;\n\t} else {\n\t\tClose=LastPrice;\n\t}\n\tif(!doc) {\n\t\tif (req.id) {\n\t\t\tvar json = {_id : req.id};\n\t\t\tjson[\"Data\"] = JSON.parse(\"{\" + \"\\\"Name\\\":\" + \"\\\"\" + Name + \"\\\"\" + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"StockData\\\":\" + \"[{\\\"TimeStamp\\\":\" + \"\\\"\" + now + \"\\\"\" + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"LocalTimestamp\\\":\" + \"\\\"\" + LocalTimestamp + \"\\\"\" + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"Price\\\":\" + LastPrice + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"Change\\\":\" + Change + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"ChangePercent\\\":\" + ChangePercent + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"High\\\":\" + High + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"Low\\\":\" + Low + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"Volume\\\":\"+ Volume + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"Close\\\":\" + Close + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"Open\\\":\" + Open + \"}]\" + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t    + \"\\\"Historical\\\":\"+\"[]\"+\"}\");\n\t\t\treturn [json, 'New Doc Created']\n\t\t\t}\n\t\treturn [null, 'Empty World'];\n\t\t}\n\n\t\toutData =  JSON.parse(\"{\" \t+ \"\\\"TimeStamp\\\":\" + \"\\\"\" + now + \"\\\"\" + \",\"\n\t\t\t\t\t\t            + \"\\\"LocalTimestamp\\\":\" + \"\\\"\" + LocalTimestamp + \"\\\"\" + \",\"\n\t\t\t\t\t\t\t\t\t+ \"\\\"Price\\\":\" + LastPrice + \",\"\n\t\t\t\t\t\t\t\t\t+ \"\\\"Change\\\":\" + Change + \",\"\n\t\t\t\t\t\t\t\t\t+ \"\\\"ChangePercent\\\":\" + ChangePercent + \",\"\n\t\t\t\t\t\t\t\t\t+ \"\\\"High\\\":\" + High + \",\"\n\t\t\t\t\t\t\t\t\t+ \"\\\"Low\\\":\" + Low + \",\"\n\t\t\t\t\t\t\t\t\t+ \"\\\"Volume\\\":\" + Volume + \",\"\n\t\t\t\t\t\t\t\t\t+ \"\\\"Close\\\":\" + Close + \",\"\n\t\t\t\t\t\t\t\t\t+ \"\\\"Open\\\":\" + Open + \"}\");\n\t\tdoc.Data.StockData.push(outData);\n\t\t//doc.Data.Historical.push(outData);\n\t\treturn[doc, 'Document Updated'];\n}\n",
       "Historical":"function(doc, req) {\n\n\tvar jsn = JSON.parse(req.body);\n\tvar Status, Name, Symbol, LastPrice, Change, ChangePercent, High, Low, Open, LocalTimestamp, Close, Volume;\n\tvar now = new Date();\n\tLocalTimestamp = jsn.Data.Timestamp;\n\tName = jsn.Data.Name;\n\tSymbol = jsn.Data.Symbol;\n\tLastPrice = jsn.Data.LastPrice;\n\tChange = jsn.Data.Change;\n\tChangePercent = jsn.Data.ChangePercent;\n\tHigh = jsn.Data.High;\n\tLow = jsn.Data.Low;\n\tOpen = jsn.Data.Open;\n\tVolume = jsn.Data.Volume;\n\tif(jsn.Data.Close){\n\t\tClose=jsn.Data.Close;\n\t} else {\n\t\tClose=LastPrice;\n\t}\n\tif(!doc) {\n\t\tif (req.id) {\n\t\t\tvar json = {_id : req.id};\n\t\t\tjson[\"Data\"] = JSON.parse(\"{\" + \"\\\"Name\\\":\" + \"\\\"\" + Name + \"\\\"\" + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"StockData\\\":\" + \"[{\\\"TimeStamp\\\":\" + \"\\\"\" + now + \"\\\"\" + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"LocalTimestamp\\\":\" + \"\\\"\" + LocalTimestamp + \"\\\"\" + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"Price\\\":\" + LastPrice + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"Change\\\":\" + Change + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"ChangePercent\\\":\" + ChangePercent + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"High\\\":\" + High + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"Low\\\":\" + Low + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"Volume\\\":\"+ Volume + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"Close\\\":\" + Close + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t+ \"\\\"Open\\\":\" + Open + \"}]\" + \",\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t    + \"\\\"Historical\\\":\"+\"[]\"+\"}\");\n\t\t\treturn [json, 'New Doc Created']\n\t\t\t}\n\t\treturn [null, 'Empty World'];\n\t\t}\n\t\tif(doc.Data.StockData.length > 0){\n\t\tdoc.Data.Historical.push(doc.Data.StockData[doc.Data.StockData.length -1]);\n\t\tdoc.Data.StockData.length = 0;\n\t\toutData =  JSON.parse(\"{\" \t+ \"\\\"TimeStamp\\\":\" + \"\\\"\" + now + \"\\\"\" + \",\"\n\t\t\t\t            + \"\\\"LocalTimestamp\\\":\" + \"\\\"\" + LocalTimestamp + \"\\\"\" + \",\"\n\t\t\t\t\t\t\t+ \"\\\"Price\\\":\" + LastPrice + \",\"\n\t\t\t\t\t\t\t+ \"\\\"Change\\\":\" + Change + \",\"\n\t\t\t\t\t\t\t+ \"\\\"ChangePercent\\\":\" + ChangePercent + \",\"\n\t\t\t\t\t\t\t+ \"\\\"High\\\":\" + High + \",\"\n\t\t\t\t\t\t\t+ \"\\\"Low\\\":\" + Low + \",\"\n\t\t\t\t\t\t\t+ \"\\\"Volume\\\":\" + Volume + \",\"\n\t\t\t\t\t\t\t+ \"\\\"Close\\\":\" + Close + \",\"\n\t\t\t\t\t\t\t+ \"\\\"Open\\\":\" + Open + \"}\");\n\t\tdoc.Data.StockData.push(outData);\n\t\treturn[doc, 'Updated Historical'];\n\t}\n}\n\n"
   }
}